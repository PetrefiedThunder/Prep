{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prep.com/schemas/vendor.v1.json",
  "title": "Vendor",
  "description": "Short-term rental operator/vendor entity",
  "type": "object",
  "required": [
    "vendor_id",
    "business_name",
    "business_type",
    "contact",
    "status",
    "created_at",
    "updated_at"
  ],
  "properties": {
    "vendor_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the vendor"
    },
    "business_name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "Legal business name"
    },
    "dba_name": {
      "type": "string",
      "maxLength": 255,
      "description": "Doing Business As (DBA) name"
    },
    "business_type": {
      "type": "string",
      "enum": [
        "sole_proprietorship",
        "llc",
        "corporation",
        "partnership",
        "trust"
      ],
      "description": "Legal structure of the business"
    },
    "tax_id": {
      "type": "string",
      "pattern": "^[0-9]{2}-[0-9]{7}$|^[0-9]{3}-[0-9]{2}-[0-9]{4}$",
      "description": "EIN or SSN (encrypted in storage)"
    },
    "contact": {
      "type": "object",
      "required": ["name", "email", "phone"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 255
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "pattern": "^\\+?[1-9]\\d{1,14}$",
          "description": "E.164 format phone number"
        },
        "address": {
          "$ref": "#/$defs/address"
        }
      },
      "additionalProperties": false
    },
    "properties": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uuid",
        "description": "Reference to property/facility IDs"
      },
      "description": "List of properties managed by this vendor"
    },
    "status": {
      "type": "string",
      "enum": [
        "pending_verification",
        "active",
        "suspended",
        "deactivated"
      ],
      "description": "Current status of the vendor account"
    },
    "verification": {
      "type": "object",
      "properties": {
        "identity_verified": {
          "type": "boolean",
          "default": false
        },
        "business_verified": {
          "type": "boolean",
          "default": false
        },
        "background_check_status": {
          "type": "string",
          "enum": ["not_started", "in_progress", "passed", "failed", "expired"]
        },
        "background_check_date": {
          "type": "string",
          "format": "date-time"
        },
        "verified_by": {
          "type": "string",
          "description": "Admin user ID who verified"
        },
        "verified_at": {
          "type": "string",
          "format": "date-time"
        }
      },
      "additionalProperties": false
    },
    "compliance": {
      "type": "object",
      "properties": {
        "overall_status": {
          "type": "string",
          "enum": ["compliant", "non_compliant", "pending", "unknown"]
        },
        "last_checked": {
          "type": "string",
          "format": "date-time"
        },
        "compliance_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Compliance score (0-100)"
        },
        "violations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["violation_id", "description", "severity", "status"],
            "properties": {
              "violation_id": {
                "type": "string",
                "format": "uuid"
              },
              "description": {
                "type": "string"
              },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              },
              "status": {
                "type": "string",
                "enum": ["open", "in_progress", "resolved"]
              },
              "detected_at": {
                "type": "string",
                "format": "date-time"
              },
              "resolved_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "stripe_account_id": {
      "type": "string",
      "pattern": "^acct_[a-zA-Z0-9]+$",
      "description": "Stripe Connect account ID for payments"
    },
    "metadata": {
      "type": "object",
      "description": "Custom key-value metadata",
      "additionalProperties": {
        "type": "string"
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time"
    },
    "deleted_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Soft delete timestamp"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "address": {
      "type": "object",
      "required": ["street", "city", "state", "postal_code", "country"],
      "properties": {
        "street": {
          "type": "string",
          "minLength": 1
        },
        "unit": {
          "type": "string"
        },
        "city": {
          "type": "string",
          "minLength": 1
        },
        "state": {
          "type": "string",
          "pattern": "^[A-Z]{2}$",
          "description": "US state code (ISO 3166-2)"
        },
        "postal_code": {
          "type": "string",
          "pattern": "^[0-9]{5}(-[0-9]{4})?$"
        },
        "country": {
          "type": "string",
          "pattern": "^[A-Z]{2}$",
          "description": "ISO 3166-1 alpha-2 country code",
          "default": "US"
        }
      },
      "additionalProperties": false
    }
  }
}
